{% extends "loja/barra_lateral.html" %}
{% block title %}Gest√£o Financeira{% endblock %}

{% block content %}
<div class="container-fluid px-4">
  <h2 class="fw-semibold mb-4">Gest√£o Financeira</h2>

  <!-- üîî Avisos Inteligentes -->
  <div class="alert alert-danger d-flex align-items-center" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>
    Gastos do m√™s est√£o acima da receita! Revise suas despesas.
  </div>

  <!-- Abas -->
  <ul class="nav nav-tabs mb-4" id="financeiroTabs" role="tablist">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#resumo">Resumo Geral</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#produtos">Produtos</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#pedidos">Pedidos</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#despesas">Despesas</button></li>
  </ul>

  <div class="tab-content">

    <!-- üîπ RESUMO GERAL -->
    <div class="tab-pane fade show active" id="resumo">
      <!-- Filtro √∫nico para todos os cards -->
      <div class="d-flex justify-content-end mb-3">
        <select class="form-select w-auto me-2">
          <option>2024</option>
          <option selected>2025</option>
        </select>
        <select class="form-select w-auto">
          <option>Janeiro</option>
          <option>Fevereiro</option>
          <option selected>Mar√ßo</option>
        </select>
      </div>

      <div class="row g-4 mb-4">
        <!-- Receita -->
        <div class="col-md-3">
          <div class="card text-center shadow-sm border-0">
            <div class="card-body">
              <h6 class="text-muted">Receita Total</h6>
              <p class="fs-5 fw-bold text-success">R$ <!-- FUTURO: total_receitas --></p>
              <small class="text-success">+15% em rela√ß√£o ao m√™s anterior</small>
            </div>
          </div>
        </div>
        <!-- Custo -->
        <div class="col-md-3">
          <div class="card text-center shadow-sm border-0">
            <div class="card-body">
              <h6 class="text-muted">Custo Total</h6>
              <p class="fs-5 fw-bold text-danger">R$ <!-- FUTURO: custo_total --></p>
              <small class="text-danger">+10% em rela√ß√£o ao m√™s anterior</small>
            </div>
          </div>
        </div>
        <!-- Despesas -->
        <div class="col-md-3">
          <div class="card text-center shadow-sm border-0">
            <div class="card-body">
              <h6 class="text-muted">Despesas Fixas</h6>
              <p class="fs-5 fw-bold text-warning">R$ <!-- FUTURO: despesas_fixas --></p>
              <small class="text-warning">-5% em rela√ß√£o ao m√™s anterior</small>
            </div>
          </div>
        </div>
        <!-- Lucro -->
        <div class="col-md-3">
          <div class="card text-center shadow-sm border-0">
            <div class="card-body">
              <h6 class="text-muted">Lucro L√≠quido</h6>
              <p class="fs-5 fw-bold text-primary">R$ <!-- FUTURO: lucro_liquido_mes --></p>
              <small class="text-primary">+8% em rela√ß√£o ao m√™s anterior</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Gr√°ficos -->
      <div class="row g-4 mb-4">
        <!-- Receitas vs Despesas -->
        <div class="col-md-4">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="fw-semibold">Receitas vs Despesas</h6>
                <div class="d-flex">
                  <select class="form-select form-select-sm me-2">
                    <option selected>2025</option>
                  </select>
                  <select class="form-select form-select-sm">
                    <option selected>Mar√ßo</option>
                  </select>
                </div>
              </div>
              <canvas id="graficoReceitasDespesas"></canvas>
            </div>
          </div>
        </div>
        <!-- Lucro L√≠quido Acumulado -->
        <div class="col-md-4">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="fw-semibold">Lucro L√≠quido Acumulado</h6>
                <div class="d-flex">
                  <select class="form-select form-select-sm me-2">
                    <option selected>2025</option>
                  </select>
                  <select class="form-select form-select-sm">
                    <option selected>Mar√ßo</option>
                  </select>
                </div>
              </div>
              <canvas id="graficoLucro"></canvas>
            </div>
          </div>
        </div>
        <!-- Despesas Fixas vs Vari√°veis -->
        <div class="col-md-4">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h6 class="fw-semibold mb-2">Despesas Fixas vs Vari√°veis</h6>
              <canvas id="graficoDespesas"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- üîπ PRODUTOS -->
    <div class="tab-pane fade" id="produtos">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="fw-semibold mb-3">Margens de Produtos</h5>
          <div class="mb-3">
            <input type="text" id="buscaProdutos" class="form-control" placeholder="Buscar produto...">
          </div>
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th>Produto</th>
                <th>Custo</th>
                <th>Pre√ßo Venda</th>
                <th>Margem (%)</th>
                <th>Lucro Unit√°rio</th>
              </tr>
            </thead>
            <tbody id="tabelaProdutos">
              <tr>
                <td>Produto Exemplo</td>
                <td>R$ 50,00</td>
                <td>R$ 80,00</td>
                <td>60%</td>
                <td>R$ 30,00</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="row g-4 mt-3">
        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h6 class="fw-semibold mb-2">Top 5 Produtos Mais Rent√°veis</h6>
              <canvas id="graficoTopMais"></canvas>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h6 class="fw-semibold mb-2">Top 5 Produtos Menos Rent√°veis</h6>
              <canvas id="graficoTopMenos"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- üîπ PEDIDOS -->
    <div class="tab-pane fade" id="pedidos">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-semibold">Lucro por Pedido</h5>
            <input type="text" id="buscaPedidos" class="form-control w-25" placeholder="Buscar pedido...">
          </div>
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th>N¬∫ Pedido</th>
                <th>Cliente</th>
                <th>Data</th>
                <th>Receita</th>
                <th>Custo</th>
                <th>Lucro</th>
              </tr>
            </thead>
            <tbody id="tabelaPedidos">
              <tr>
                <td>#202509-AB12CD34</td>
                <td>Cliente Exemplo</td>
                <td>08/09/2025</td>
                <td>R$ 500,00</td>
                <td>R$ 300,00</td>
                <td class="text-success">R$ 200,00</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- üîπ DESPESAS -->
    <div class="tab-pane fade" id="despesas">
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h5 class="fw-semibold mb-3">Adicionar Despesa</h5>
              <form>
                <div class="mb-3">
                  <label class="form-label">Categoria</label>
                  <input type="text" class="form-control" placeholder="Ex: Aluguel, Marketing">
                </div>
                <div class="mb-3">
                  <label class="form-label">Tipo</label>
                  <select class="form-select">
                    <option>Fixo</option>
                    <option>Vari√°vel</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Valor (R$)</label>
                  <input type="number" step="0.01" class="form-control">
                </div>
                <div class="mb-3">
                  <label class="form-label">Data</label>
                  <input type="date" class="form-control">
                </div>
                <div class="mb-3">
                  <label class="form-label">Descri√ß√£o</label>
                  <textarea class="form-control"></textarea>
                </div>
                <button class="btn btn-danger" type="submit"><i class="bi bi-plus-circle"></i> Adicionar</button>
              </form>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h5 class="fw-semibold mb-3">Despesas Registradas</h5>
              <table class="table table-striped align-middle">
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Categoria</th>
                    <th>Tipo</th>
                    <th>Valor</th>
                    <th>A√ß√µes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>01/09/2025</td>
                    <td>Aluguel</td>
                    <td>Fixo</td>
                    <td>R$ 1.200,00</td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary"><i class="bi bi-pencil"></i></button>
                      <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Exemplos de gr√°ficos
new Chart(document.getElementById('graficoReceitasDespesas'), {
  type: 'bar',
  data: { labels: ['Jan','Fev','Mar'], datasets: [
    { label: 'Receitas', data: [1000,1200,1500], backgroundColor: '#198754' },
    { label: 'Despesas', data: [600,800,700], backgroundColor: '#dc3545' }
  ]}
});
new Chart(document.getElementById('graficoLucro'), {
  type: 'line',
  data: { labels: ['Jan','Fev','Mar'], datasets: [
    { label: 'Lucro L√≠quido', data: [400,500,800], borderColor: '#0d6efd', fill: true }
  ]}
});
new Chart(document.getElementById('graficoDespesas'), {
  type: 'doughnut',
  data: { labels: ['Fixas','Vari√°veis'], datasets: [
    { data: [2000,1500], backgroundColor: ['#ffc107','#0dcaf0'] }
  ]}
});
new Chart(document.getElementById('graficoTopMais'), {
  type: 'bar',
  data: { labels: ['Produto A','Produto B','Produto C'], datasets: [
    { label: 'Lucro', data: [500,400,300], backgroundColor: '#20c997' }
  ]}
});
new Chart(document.getElementById('graficoTopMenos'), {
  type: 'bar',
  data: { labels: ['Produto X','Produto Y','Produto Z'], datasets: [
    { label: 'Lucro', data: [50,30,10], backgroundColor: '#fd7e14' }
  ]}
});

// Busca instant√¢nea
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("buscaProdutos").addEventListener("input", function() {
    const termo = this.value.toLowerCase();
    document.getElementById("tabelaProdutos").querySelectorAll("tr").forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(termo) ? "" : "none";
    });
  });
  document.getElementById("buscaPedidos").addEventListener("input", function() {
    const termo = this.value.toLowerCase();
    document.getElementById("tabelaPedidos").querySelectorAll("tr").forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(termo) ? "" : "none";
    });
  });
});
</script>
{% endblock %}
