{% extends "loja/barra_lateral.html" %}
{% block title %}Gest칚o Financeira - Hist칩rico de Custo{% endblock %}

{% block content %}
<div class="container-fluid px-4">
  <h2 class="fw-semibold mb-3">Hist칩rico de Custo</h2>

  <!-- 游댳 Form de filtro por datas (GET) -->
  <form method="get" class="row g-3 mb-4">
    <div class="col-auto">
      <label for="data_inicio" class="form-label">Data in칤cio</label>
      <input type="date" id="data_inicio" name="data_inicio" class="form-control"
             value="{{ data_inicio }}">
    </div>
    <div class="col-auto">
      <label for="data_fim" class="form-label">Data fim</label>
      <input type="date" id="data_fim" name="data_fim" class="form-control"
             value="{{ data_fim }}">
    </div>
    <div class="col-auto align-self-end">
      <button type="submit" class="btn btn-primary">Filtrar</button>
    </div>
  </form>

  <!-- 游댳 Tabela de hist칩rico -->
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead class="table-light">
            <tr>
              <th>Data</th>
              <th>Produto</th>
              <th>Custo Antigo</th>
              <th>Custo Novo</th>
              <th>Respons치vel</th>
              <th>Descri칞칚o</th>
            </tr>
          </thead>
          <tbody>
            {% for h in historicos %}
            <tr>
              <td>{{ h.data|date:"d/m/Y H:i" }}</td>
              <td>{{ h.produto.nome }}</td>
              <td><span class="text-nowrap">R$ {{ h.custo_antigo|floatformat:2 }}</span></td>
              <td><span class="text-nowrap">R$ {{ h.custo_novo|floatformat:2 }}</span></td>
              <td>{{ h.usuario.username }}</td>
              <td class="text-muted">{{ h.descricao|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center text-muted">Nenhum hist칩rico encontrado</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- 游댳 Bot칚o de voltar para Produtos (mantendo filtros) -->
      <div class="mt-3">
        <a class="btn btn-outline-secondary btn-sm"
           href="{% url 'financeiro_produtos' %}{% if request.GET.urlencode %}?{{ request.GET.urlencode }}{% endif %}">
           <i class="bi bi-arrow-left"></i> Voltar para Produtos
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
