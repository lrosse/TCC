{% extends 'loja/barra_lateral.html' %}

{% block title %}Lista de Produtos{% endblock %}

{% block content %}

<style>
.action-btn {
  text-decoration: none;
  transition: transform 0.2s ease;
}
.action-btn:hover {
  transform: scale(1.2); /* aumenta só o tamanho */
}
</style>

<div class="container-fluid px-4" style="background-color: #f8fafc; min-height: 100vh; padding-top: 2rem;">

  <!-- Cabeçalho -->
  <div class="d-flex justify-content-between align-items-center mb-4 p-4 bg-white rounded shadow-sm">
    <h2 class="fw-bold mb-0" style="color: #1e293b; letter-spacing: -0.025em;">Lista de produtos</h2>
    <a href="{% url 'criar_produto' %}" class="btn btn-success" style="background: #10b981; border: none; border-radius: 8px; padding: 12px 24px; font-weight: 600; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
      <i class="bi bi-plus-circle me-2"></i> Novo produto
    </a>
  </div>

<!-- Barra de busca + botão de filtros -->
<div class="mb-3 p-3 bg-white rounded shadow-sm">
  <label for="filtro-nome" class="form-label fw-semibold" style="color: #475569; font-size: 0.875rem;">Pesquisar produtos</label>
  
  <div class="d-flex align-items-center gap-2">
    <!-- Campo de busca -->
    <input type="text" id="filtro-nome" 
           class="form-control form-control-sm"
           placeholder="Digite o nome ou ID do produto..."
           style="max-width: 350px; border: 2px solid #e2e8f0; border-radius: 8px; background: #f8fafc; font-size: 0.8125rem;">
    
    <!-- Botão de filtro -->
    <button class="btn btn-outline-secondary btn-sm d-flex align-items-center justify-content-center"
            type="button" data-bs-toggle="collapse" 
            data-bs-target="#filtrosExtras" aria-expanded="false" aria-controls="filtrosExtras"
            style="border: 2px solid #e2e8f0; border-radius: 8px; font-weight: 500; padding: 6px 10px; height: 32px;">
      <i class="bi bi-sliders"></i>
    </button>
  </div>
</div>

  <!-- Campos extras (colapsáveis) -->
  <div class="collapse mb-3" id="filtrosExtras">
    <div class="row g-2 p-3 bg-white rounded shadow-sm" style="border: 1px solid #e2e8f0; margin-top: 1rem;">
      <div class="col-md-2">
        <label for="preco-min" class="form-label" style="font-size: 0.75rem; color: #475569;">Preço mín.</label>
        <input type="number" id="preco-min" class="form-control form-control-sm" placeholder="R$ 0,00">
      </div>
      <div class="col-md-2">
        <label for="preco-max" class="form-label" style="font-size: 0.75rem; color: #475569;">Preço máx.</label>
        <input type="number" id="preco-max" class="form-control form-control-sm" placeholder="R$ 999,99">
      </div>
      <div class="col-md-2">
        <label for="qtd-min" class="form-label" style="font-size: 0.75rem; color: #475569;">Qtd mín.</label>
        <input type="number" id="qtd-min" class="form-control form-control-sm" placeholder="0">
      </div>
      <div class="col-md-2">
        <label for="qtd-max" class="form-label" style="font-size: 0.75rem; color: #475569;">Qtd máx.</label>
        <input type="number" id="qtd-max" class="form-control form-control-sm" placeholder="999">
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button type="button" id="btn-limpar" class="btn btn-outline-danger btn-sm w-100">
          <i class="bi bi-arrow-clockwise me-1"></i> Limpar
        </button>
      </div>
    </div>
  </div>

  <!-- Tabela -->
  <div class="card shadow-sm" style="border: none; border-radius: 12px; overflow: hidden;">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead style="background: #f8fafc;">
            <tr>
              <th style="color: #64748b; font-weight: 500; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; padding: 1rem 1.5rem; border-bottom: 2px solid #e2e8f0; width: 150px;">Produto ID</th>
              <th style="color: #64748b; font-weight: 500; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; padding: 1rem 1.5rem; border-bottom: 2px solid #e2e8f0;">Nome</th>
              <th style="color: #64748b; font-weight: 500; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; padding: 1rem 1.5rem; border-bottom: 2px solid #e2e8f0; width: 120px;">Preço</th>
              <th style="color: #64748b; font-weight: 500; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; padding: 1rem 1.5rem; border-bottom: 2px solid #e2e8f0; width: 200px;">Descrição</th>
              <th style="color: #64748b; font-weight: 500; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; padding: 1rem 1.5rem; border-bottom: 2px solid #e2e8f0; width: 120px;">Quantidade</th>
              <th style="color: #64748b; font-weight: 500; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; padding: 1rem 1.5rem; border-bottom: 2px solid #e2e8f0; width: 140px;">Ações</th>
            </tr>
          </thead>
          <tbody id="tabela-produtos">
            {% for produto in produtos %}
            <tr data-id="{{ produto.id }}" 
                data-nome="{{ produto.nome|lower }}" 
                data-preco="{{ produto.preco }}" 
                data-qtd="{{ produto.quantidade }}"
                style="border-bottom: 1px solid #e2e8f0; transition: all 0.2s ease;"
                onmouseover="this.style.backgroundColor='#f8fafc'"
                onmouseout="this.style.backgroundColor='white'">
              
              <!-- Miniatura + ID -->
              <td style="padding: 1rem 1.25rem; vertical-align: middle;">
                <div class="d-flex align-items-center gap-2">
                  {% if produto.imagem %}
                    <img src="{{ produto.imagem.url }}" alt="{{ produto.nome }}"
                         class="rounded" style="width: 40px; height: 40px; object-fit: cover;">
                  {% else %}
                    <div class="d-flex align-items-center justify-content-center"
                         style="width: 40px; height: 40px; background: #e2e8f0; border-radius: 8px; color: #64748b;">
                      <i class="bi bi-box"></i>
                    </div>
                  {% endif %}
                  <span style="font-weight: 600; color: #64748b; font-size: 0.8125rem;">#{{ produto.id }}</span>
                </div>
              </td>

              <!-- Nome -->
              <td style="padding: 1rem 1.25rem; vertical-align: middle;">
                <div style="font-weight: 600; color: #1e293b; font-size: 0.875rem;">{{ produto.nome }}</div>
              </td>

              <!-- Preço -->
              <td style="padding: 1rem 1.25rem; vertical-align: middle;">
                <div style="font-weight: 700; color: #1e293b; font-size: 0.875rem;">R$ {{ produto.preco }}</div>
              </td>

              <!-- Descrição -->
              <td style="padding: 1rem 1.25rem; vertical-align: middle;">
                <div style="color: #64748b; font-size: 0.8125rem; line-height: 1.4;">{{ produto.descricao|truncatechars:50 }}</div>
              </td>

              <!-- Quantidade -->
              <td style="padding: 1rem 1.25rem; vertical-align: middle;">
                {{ produto.quantidade|default:"0" }}
              </td>

              <!-- Ações -->
              <!-- Ações -->
            <td style="padding: 1rem 1.25rem; vertical-align: middle; text-align: center;">
            <div class="d-flex justify-content-center gap-3">
                <!-- Botão Editar -->
                <a href="{% url 'editar_produto' produto.id %}" 
                class="action-btn text-dark"
                style="font-size: 1.1rem;">
                <i class="bi bi-pencil-square"></i>
                </a>

                <!-- Botão Excluir -->
                <a href="{% url 'excluir_produto' produto.id %}" 
                class="action-btn text-danger"
                style="font-size: 1.1rem;">
                <i class="bi bi-trash"></i>
                </a>
            </div>
            </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center py-5" style="color: #64748b;">
                <i class="bi bi-inbox display-1 mb-3 d-block"></i>
                <p class="mb-1">Nenhum produto cadastrado ainda.</p>
                <small>Clique em "Novo produto" para começar.</small>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{% block extra_js %}
<script>
const filtroNome = document.getElementById("filtro-nome");
const precoMin = document.getElementById("preco-min");
const precoMax = document.getElementById("preco-max");
const qtdMin = document.getElementById("qtd-min");
const qtdMax = document.getElementById("qtd-max");
const btnLimpar = document.getElementById("btn-limpar");
const linhas = document.querySelectorAll("#tabela-produtos tr[data-id]");

function aplicarFiltros() {
  const termo = filtroNome.value.trim().toLowerCase();
  const pMin = parseFloat(precoMin?.value) || 0;
  const pMax = parseFloat(precoMax?.value) || Infinity;
  const qMin = parseInt(qtdMin?.value) || 0;
  const qMax = parseInt(qtdMax?.value) || Infinity;

  linhas.forEach(tr => {
    const id = tr.dataset.id;
    const nome = tr.dataset.nome;
    const preco = parseFloat(tr.dataset.preco);
    const qtd = parseInt(tr.dataset.qtd);

    const matchNome = nome.includes(termo) || id.includes(termo);
    const matchPreco = preco >= pMin && preco <= pMax;
    const matchQtd = qtd >= qMin && qtd <= qMax;

    tr.style.display = (matchNome && matchPreco && matchQtd) ? "" : "none";
  });
}

[filtroNome, precoMin, precoMax, qtdMin, qtdMax].forEach(el => {
  el?.addEventListener("input", aplicarFiltros);
});

btnLimpar.addEventListener("click", () => {
  filtroNome.value = "";
  precoMin.value = "";
  precoMax.value = "";
  qtdMin.value = "";
  qtdMax.value = "";
  aplicarFiltros();
});
</script>
{% endblock %}
{% endblock %}
